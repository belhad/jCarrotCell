/*!
 * jCarrotCell
 * http://jcarrotcell.yujulia.com
 * 
 * Copyright 2011, 2015 
 * Released under the MIT license
 *
 */
!function(e){var n=37,t=39,s=38,o=40,r=200,i="carrotcell",a=i+"__clip",c=i+"__strip",u=i+"__item",l=i+"--invisible",d=i+"__icon",p=d+"--next",f=d+"--prev",h=i+"__accessText",y=i+"__btn",v=y+"--next",w=y+"--prev",k=function(e,n){var t=null;return function(){var s=this,o=arguments,r=function(){t=null,e.apply(s,o)};clearTimeout(t),t=setTimeout(r,n)}},m=function(e,n){if(Object.keys(e).length!==Object.keys(n).length)return!1;for(var t in e){if(!(t in n))return!1;if(e[t]!==n[t])return!1}return!0},g=function(){var r=null,k=0,g=0,C=null,b=null,I=0,z=null,T=0,O=null,_=null,B=null,F=0,N=0,R=0,S=0,E=!0,K=!1,M=0,D=!1,L="x",P={show:1,scroll:1,speed:700,sideways:!0,infinite:!1,auto:!1,tween:"easeOutExpo",prevClass:"",nextClass:"",prevIconClass:f,nextIconClass:p,prevText:"next",nextText:"previous",controlOnHover:!1,key:!1,keyBack:"",keyForward:""},j=function(){E&&(_.prop("disabled",!1),E=!1),K&&(B.prop("disabled",!1),K=!1)},H=function(){j(),E=!0,_.prop("disabled",!0)},A=function(){j(),K=!0,B.prop("disabled",!0)},J=function(){console.log("current ",M," moves ",F," moved ",N),0===N?H():N===F?A():j()},U=function(e,n){M=e,N+=n,D=!1,P.infinite||J()},W=function(e,n){var t=n*Math.abs(M-e)*O.totalSize+N*O.totalSize;D=!0,b.velocity("scroll",{axis:L,duration:P.speed,offset:t,container:C,complete:U.bind(this,e,n),easing:P.tween})},Q=function(e){return e&&e.preventDefault(),E||D?!1:void W(M-P.scroll,-1)},V=function(e){return e&&e.preventDefault(),K||D?!1:void W(M+P.scroll,1)},q=function(e){e===P.keyBack&&Q(),e===P.keyForward&&V()},G=function(){var n=e("<span/>",{"class":h,text:P.prevText}),t=e("<span/>",{"class":h,text:P.nextText}),s=e("<span/>",{"class":P.prevIconClass,"aria-hidden":"true"}),o=e("<span/>",{"class":P.nextIconClass,"aria-hidden":"true"});_=e("<button/>",{"class":P.prevClass}),B=e("<button/>",{"class":P.nextClass}),_.append(s).append(n),B.append(t).append(o),E&&_.prop("disabled",!0),_.click(Q),B.click(V);var i=function(){_.blur()},a=function(){B.blur()},c=function(){B.removeClass(l),_.removeClass(l)},u=function(){B.addClass(l).blur(),_.addClass(l).blur()};P.controlOnHover&&!x.touch?(u(),r.hover(c,u)):(_.mouseleave(i),B.mouseleave(a)),r.prepend(B).prepend(_)},X=function(){var n=function(n){var t=e(this).data("enum");e.isNumeric(t)&&t>0&&t!==M&&W(t,1)};z.focus(n)},Y=function(){G(),P.key&&x.subscribeKey(P.name,P.keyBack,P.keyForward),X()},Z=function(){F=Math.ceil(T/P.scroll)-(P.show-P.scroll)-1,R=P.show*Math.ceil(T/P.show),S=R-T,console.log("moves ",F," slots ",R,"empty ",S)},$=function(n){var t={};return e.each(n[0].attributes,function(e,n){t[n.nodeName]=n.nodeValue}),t},ee=function(n){var t=0;if(t=P.sideways?parseInt(n.css("margin-left"),10)+parseInt(n.css("margin-right"),10):parseInt(n.css("margin-top"),10)+parseInt(n.css("margin-bottom"),10),"content-box"===e(n).css("box-sizing"))if(P.sideways){var s=parseInt(n.css("border-left-width"),10),o=parseInt(n.css("border-right-width"),10);t+=s+o}else{var r=parseInt(n.css("border-top-width"),10),i=parseInt(n.css("border-bottom-width"),10);t+=r+i}return{w:n.outerWidth(!0),h:n.outerHeight(!0),offset:t}},ne=function(){z.each(function(n,t){t=e(t),t.data("enum",n),1>n&&(O=ee(t)),I+=P.sideways?O.w:O.h})},te=function(){ne();var e=function(e,n){O.size=e-O.offset,console.log("one item ",O.size," single ",e," offset ",O.offset),O.totalSize=O.size+O.offset,z.css(n,O.size+"px"),b.css(n,e*T+O.offset+"px")};P.sideways?e(k/P.show,"width"):e(g/P.show,"height")},se=function(){k=parseInt(Math.floor(r.width()),10),g=parseInt(Math.floor(r.height()),10),P.sideways?C.css("width",k+"px"):C.css("height",g+"px")},oe=function(){C=e("<div/>",{"class":a}),se();var n="<div/>",t=r.prop("tagName").toUpperCase(),s=!1;if(("UL"===t||"OL"===t)&&(s=!0,n="<"+t+"/>"),b=e(n,{"class":c}),z.appendTo(b),b.appendTo(C),s){var o=$(r),l=e("<div/>",o);C.appendTo(l),r.replaceWith(l),r=l}else r.empty(),C.appendTo(r);z.addClass(u).attr("tabindex",0),r.addClass(i).data(i,P.name),te()},re=function(){P.auto&&(P.infinite=!0),L=P.sideways?"x":"y",P.key&&(P.sideways?(P.keyBack=P.keyBack||n,P.keyForward=P.keyForward||t):(P.keyBack=P.keyBack||s,P.keyForward=P.keyForward||o)),P.prevClass=y+" "+w+" "+P.prevClass,P.nextClass=y+" "+v+" "+P.nextClass,P.prevIconClass=d+" "+P.prevIconClass,P.nextIconClass=d+" "+P.nextIconClass,P.infinite&&(E=!1)},ie=function(){se(),te(),N>0&&b.velocity("scroll",{axis:L,duration:0,offset:N*O.totalSize,container:C})};setup=function(){z=r.children(),T=z.length,re(),oe(),T>P.show&&T>1&&(Z(),Y())};var ae={init:function(n){r=n.scope,e.extend(P,n),setup()},update:function(n){return m(n,JSON.parse(P.userOptions))?!1:(e.extend(P,n),void setup())},resize:function(){ie()},keyPressed:function(e){q(e)},getName:function(){return P.name}};return ae},x={carrots:{},keys:{},count:0,initialized:!1,useKey:!1,touch:!1,triggerCarrots:function(e){for(var n in x.carrots)"function"==typeof x.carrots[n][e]&&x.carrots[n][e]()},subscribeKey:function(){x.useKey||(e(window).keyup(x.keyPressed),x.useKey=!0);var n=Array.prototype.slice.call(arguments),t=n.shift();n.forEach(function(e){e in x.keys?x.keys[e].push(t):x.keys[e]=[t]})},keyPressed:function(e){e.keyCode in x.keys&&x.keys[e.keyCode].forEach(function(n){x.carrots[n].keyPressed(e.keyCode)})},windowResized:k(function(){x.triggerCarrots("resize")},r),makeCarrot:function(n){x.count++,n||(n={}),n.userOptions=JSON.stringify(n),n.scope=e(this),n.name="carrot-"+x.count+"-"+n.scope.attr("id");var t=new g;return x.carrots[n.name]=t,t.init(n),t},init:function(){e(window).on("resize",x.windowResized),("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)&&(x.touch=!0),x.initialize=!0}};e.fn.carrotCell=function(){x.initialize||x.init();var n=e(this).data(i);if(n){console.log("this exists");var t=x.carrots[n];return t?(t.update.apply(this,arguments),t):(console.log("CARROTCELL ERROR: ",n," is not a registered carrotcell."),!1)}console.log("making new");var s=x.makeCarrot.apply(this,arguments),o=s.getName();return x.carrots[o]=s,s}}(jQuery);